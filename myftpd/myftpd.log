Thu Nov  2 14:16:39 2017-server initialised
Thu Nov  2 14:16:39 2017-dir set to /home/clem/Dropbox/uni/2017-S2/ICT374/assignments/a2/ICT374-myftp/myftpd
Thu Nov  2 14:16:39 2017-myftp server now listening on port 40007
Thu Nov  2 14:16:42 2017-client 1-connected
Thu Nov  2 14:16:44 2017-client 1-PUT
Thu Nov  2 14:16:44 2017-client 1-filename size: 6
Thu Nov  2 14:16:44 2017-client 1-debug
Thu Nov  2 14:16:44 2017-client 1-filename length: 5
Thu Nov  2 14:16:44 2017-client 1-filename: a.txt
Thu Nov  2 14:16:44 2017-client 1-returned OP_PUT
Thu Nov  2 14:16:44 2017-client 1-returned ackcode:0
Thu Nov  2 14:16:44 2017-client 1-filetype: 0
Thu Nov  2 14:16:44 2017-client 1-filesize:8
Thu Nov  2 14:18:40 2017-client 1-content:`t∑˝
Thu Nov  2 14:18:40 2017-client 1-returned ackcode:0
Thu Nov  2 14:18:40 2017-client 1-disconnected
Thu Nov  2 14:18:51 2017-ttimeserver initialised
Thu Nov  2 14:18:51 2017-dir set to /home/clem/Dropbox/uni/2017-S2/ICT374/assignments/a2/ICT374-myftp/myftpd
Thu Nov  2 14:18:51 2017-myftp server now listening on port 40007
Thu Nov  2 14:18:55 2017-client 1-connected
Thu Nov  2 14:18:57 2017-client 1-PUT
Thu Nov  2 14:18:57 2017-client 1-filename size: 6
Thu Nov  2 14:18:57 2017-client 1-debug
Thu Nov  2 14:18:57 2017-client 1-filename length: 5
Thu Nov  2 14:18:57 2017-client 1-filename: a.txt
Thu Nov  2 14:18:57 2017-client 1-returned OP_PUT
Thu Nov  2 14:18:57 2017-client 1-returned ackcode:0
Thu Nov  2 14:18:57 2017-client 1-filetype: 0
Thu Nov  2 14:18:57 2017-client 1-filesize:8
Thu Nov  2 14:25:54 2017-client 1-content:∞◊ ˝
Thu Nov  2 14:25:54 2017-client 1-returned ackcode:0
Thu Nov  2 14:25:54 2017-client 1-disconnected
Thu Nov  2 14:28:17 2017-ttimeserver initialised
Thu Nov  2 14:28:17 2017-dir set to /home/clem/Dropbox/uni/2017-S2/ICT374/assignments/a2/ICT374-myftp/myftpd
Thu Nov  2 14:28:17 2017-myftp server now listening on port 40007
Thu Nov  2 14:28:20 2017-client 1-connected
Thu Nov  2 14:28:22 2017-client 1-PUT
Thu Nov  2 14:28:22 2017-client 1-filename size: 6
Thu Nov  2 14:28:22 2017-client 1-debug
Thu Nov  2 14:28:22 2017-client 1-filename length: 5
Thu Nov  2 14:28:22 2017-client 1-filename: a.txt
Thu Nov  2 14:28:22 2017-client 1-returned OP_PUT
Thu Nov  2 14:28:22 2017-client 1-returned ackcode:0
Thu Nov  2 14:28:22 2017-client 1-filetype: 0
Thu Nov  2 14:28:22 2017-client 1-filesize:8
Thu Nov  2 14:30:47 2017-client 1-content:0}Wäˇ
Thu Nov  2 14:30:47 2017-client 1-returned ackcode:0
Thu Nov  2 14:30:47 2017-client 1-disconnected
Thu Nov  2 14:30:59 2017-server initialised
Thu Nov  2 14:30:59 2017-dir set to /home/clem/Dropbox/uni/2017-S2/ICT374/assignments/a2/ICT374-myftp/myftpd
Thu Nov  2 14:30:59 2017-myftp server now listening on port 40007
Thu Nov  2 14:31:02 2017-client 1-connected
Thu Nov  2 14:31:03 2017-client 1-PUT
Thu Nov  2 14:31:03 2017-client 1-filename size: 6
Thu Nov  2 14:31:03 2017-client 1-debug
Thu Nov  2 14:31:03 2017-client 1-filename length: 5
Thu Nov  2 14:31:03 2017-client 1-filename: a.txt
Thu Nov  2 14:31:03 2017-client 1-returned OP_PUT
Thu Nov  2 14:31:03 2017-client 1-returned ackcode:0
Thu Nov  2 14:31:03 2017-client 1-filetype: 0
Thu Nov  2 14:31:03 2017-client 1-filesize:8
Thu Nov  2 14:32:07 2017-client 1-content:‡ ﬁ¥¸
Thu Nov  2 14:32:07 2017-client 1-returned ackcode:0
Thu Nov  2 14:32:07 2017-client 1-disconnected
Thu Nov  2 14:33:32 2017-client 2-connected
Thu Nov  2 14:33:34 2017-client 2-PUT
Thu Nov  2 14:33:34 2017-client 2-filename size: 9
Thu Nov  2 14:33:34 2017-client 2-debug
Thu Nov  2 14:33:34 2017-client 2-filename length: 8
Thu Nov  2 14:33:34 2017-client 2-filename: stream.o
Thu Nov  2 14:33:34 2017-client 2-returned OP_PUT
Thu Nov  2 14:33:34 2017-client 2-returned ackcode:0
Thu Nov  2 14:33:34 2017-client 2-filetype: 1
Thu Nov  2 14:33:34 2017-client 2-filesize:4376
Thu Nov  2 14:35:29 2017-client 2-content:ãEÙÎãEÙEÏãEÏ;E|¡ãEHãu¯dH34%(
Thu Nov  2 14:35:29 2017-client 2-returned ackcode:0
Thu Nov  2 14:35:29 2017-client 2-disconnected
Thu Nov  2 14:35:44 2017-server initialised
Thu Nov  2 14:35:44 2017-dir set to /home/clem/Dropbox/uni/2017-S2/ICT374/assignments/a2/ICT374-myftp/myftpd
Thu Nov  2 14:35:44 2017-myftp server now listening on port 40007
Thu Nov  2 14:35:52 2017-client 1-connected
Thu Nov  2 14:35:55 2017-client 1-PUT
Thu Nov  2 14:35:55 2017-client 1-filename size: 6
Thu Nov  2 14:35:55 2017-client 1-debug
Thu Nov  2 14:35:55 2017-client 1-filename length: 5
Thu Nov  2 14:35:55 2017-client 1-filename: a.txt
Thu Nov  2 14:35:55 2017-client 1-returned OP_PUT
Thu Nov  2 14:35:55 2017-client 1-returned ackcode:0
Thu Nov  2 14:35:55 2017-client 1-filetype: 0
Thu Nov  2 14:35:55 2017-client 1-filesize:8
Thu Nov  2 14:37:15 2017-client 1-content:Än«À¸
Thu Nov  2 14:37:15 2017-client 1-returned ackcode:0
Thu Nov  2 14:37:15 2017-client 1-disconnected
Thu Nov  2 14:37:19 2017-client 2-connected
Thu Nov  2 14:37:21 2017-client 2-PUT
Thu Nov  2 14:37:21 2017-client 2-filename size: 6
Thu Nov  2 14:37:21 2017-client 2-debug
Thu Nov  2 14:37:21 2017-client 2-filename length: 5
Thu Nov  2 14:37:21 2017-client 2-filename: a.txt
Thu Nov  2 14:37:21 2017-client 2-returned OP_PUT
Thu Nov  2 14:37:21 2017-client 2-returned ackcode:0
Thu Nov  2 14:37:21 2017-client 2-filetype: 0
Thu Nov  2 14:37:21 2017-client 2-filesize:8
Thu Nov  2 14:39:39 2017-client 2-content:Än«À¸
Thu Nov  2 14:39:39 2017-client 2-returned ackcode:0
Thu Nov  2 14:39:39 2017-client 2-disconnected
Thu Nov  2 14:40:01 2017-client 3-connected
Thu Nov  2 14:40:02 2017-client 3-PUT
Thu Nov  2 14:40:02 2017-client 3-filename size: 6
Thu Nov  2 14:40:02 2017-client 3-debug
Thu Nov  2 14:40:02 2017-client 3-filename length: 5
Thu Nov  2 14:40:02 2017-client 3-filename: a.txt
Thu Nov  2 14:40:02 2017-client 3-returned OP_PUT
Thu Nov  2 14:40:02 2017-client 3-returned ackcode:0
Thu Nov  2 14:40:02 2017-client 3-filetype: 0
Thu Nov  2 14:40:02 2017-client 3-filesize:8
Thu Nov  2 14:40:09 2017-client 3-content:Än«À¸
Thu Nov  2 14:40:09 2017-client 3-returned ackcode:0
Thu Nov  2 14:40:09 2017-client 3-disconnected
Thu Nov  2 14:40:19 2017-server initialised
Thu Nov  2 14:40:19 2017-dir set to /home/clem/Dropbox/uni/2017-S2/ICT374/assignments/a2/ICT374-myftp/myftpd
Thu Nov  2 14:40:19 2017-myftp server now listening on port 40007
Thu Nov  2 14:40:22 2017-client 1-connected
Thu Nov  2 14:40:24 2017-client 1-PUT
Thu Nov  2 14:40:24 2017-client 1-filename size: 6
Thu Nov  2 14:40:24 2017-client 1-debug
Thu Nov  2 14:40:24 2017-client 1-filename length: 5
Thu Nov  2 14:40:24 2017-client 1-filename: a.txt
Thu Nov  2 14:40:24 2017-client 1-returned OP_PUT
Thu Nov  2 14:40:24 2017-client 1-returned ackcode:0
Thu Nov  2 14:40:24 2017-client 1-filetype: 0
Thu Nov  2 14:40:24 2017-client 1-filesize:8
Thu Nov  2 14:41:54 2017-client 1-content:†P±¸
Thu Nov  2 14:41:54 2017-client 1-returned ackcode:0
Thu Nov  2 14:41:54 2017-client 1-disconnected
Thu Nov  2 14:42:05 2017-ttimeserver initialised
Thu Nov  2 14:42:05 2017-dir set to /home/clem/Dropbox/uni/2017-S2/ICT374/assignments/a2/ICT374-myftp/myftpd
Thu Nov  2 14:42:05 2017-myftp server now listening on port 40007
Thu Nov  2 14:42:09 2017-client 1-connected
Thu Nov  2 14:42:11 2017-client 1-PUT
Thu Nov  2 14:42:11 2017-client 1-filename size: 6
Thu Nov  2 14:42:11 2017-client 1-debug
Thu Nov  2 14:42:11 2017-client 1-filename length: 5
Thu Nov  2 14:42:11 2017-client 1-filename: a.txt
Thu Nov  2 14:42:11 2017-client 1-returned OP_PUT
Thu Nov  2 14:42:11 2017-client 1-returned ackcode:0
Thu Nov  2 14:42:11 2017-client 1-filetype: 0
Thu Nov  2 14:42:11 2017-client 1-filesize:8
Thu Nov  2 14:43:21 2017-client 1-content:ê@‹w˛
Thu Nov  2 14:43:21 2017-client 1-returned ackcode:0
Thu Nov  2 14:43:21 2017-client 1-disconnected
Thu Nov  2 14:43:31 2017-client 2-connected
Thu Nov  2 14:43:34 2017-client 2-PUT
Thu Nov  2 14:43:34 2017-client 2-filename size: 6
Thu Nov  2 14:43:34 2017-client 2-debug
Thu Nov  2 14:43:34 2017-client 2-filename length: 5
Thu Nov  2 14:43:34 2017-client 2-filename: a.txt
Thu Nov  2 14:43:34 2017-client 2-returned OP_PUT
Thu Nov  2 14:43:34 2017-client 2-returned ackcode:0
Thu Nov  2 14:43:34 2017-client 2-filetype: 0
Thu Nov  2 14:43:34 2017-client 2-filesize:8
Thu Nov  2 14:44:51 2017-client 2-content:ê@‹w˛
Thu Nov  2 14:44:51 2017-client 2-returned ackcode:0
Thu Nov  2 14:44:51 2017-client 2-disconnected
Thu Nov  2 14:44:55 2017-client 3-connected
Thu Nov  2 14:44:57 2017-client 3-PUT
Thu Nov  2 14:44:57 2017-client 3-filename size: 6
Thu Nov  2 14:44:57 2017-client 3-debug
Thu Nov  2 14:44:57 2017-client 3-filename length: 5
Thu Nov  2 14:44:57 2017-client 3-filename: a.txt
Thu Nov  2 14:44:57 2017-client 3-returned OP_PUT
Thu Nov  2 14:44:57 2017-client 3-returned ackcode:0
Thu Nov  2 14:44:57 2017-client 3-filetype: 0
Thu Nov  2 14:44:57 2017-client 3-filesize:8
Thu Nov  2 14:45:24 2017-client 3-content:ê@‹w˛
Thu Nov  2 14:45:24 2017-client 3-returned ackcode:0
Thu Nov  2 14:45:24 2017-client 3-disconnected
Thu Nov  2 14:47:01 2017-client 4-connected
Thu Nov  2 14:47:03 2017-client 4-PUT
Thu Nov  2 14:47:03 2017-client 4-filename size: 6
Thu Nov  2 14:47:03 2017-client 4-debug
Thu Nov  2 14:47:03 2017-client 4-filename length: 5
Thu Nov  2 14:47:03 2017-client 4-filename: a.txt
Thu Nov  2 14:47:03 2017-client 4-returned OP_PUT
Thu Nov  2 14:47:03 2017-client 4-returned ackcode:0
Thu Nov  2 14:47:03 2017-client 4-filetype: 0
Thu Nov  2 14:47:03 2017-client 4-filesize:8
Thu Nov  2 14:47:03 2017-client 4-content:a
b c d

Thu Nov  2 14:47:03 2017-client 4-returned ackcode:0
Thu Nov  2 14:48:20 2017-client 4-PUT
Thu Nov  2 14:48:20 2017-client 4-filename size: 9
Thu Nov  2 14:48:20 2017-client 4-debug
Thu Nov  2 14:48:20 2017-client 4-filename length: 8
Thu Nov  2 14:48:20 2017-client 4-filename: stream.c
Thu Nov  2 14:48:20 2017-client 4-returned OP_PUT
Thu Nov  2 14:48:20 2017-client 4-returned ackcode:0
Thu Nov  2 14:48:20 2017-client 4-filetype: 0
Thu Nov  2 14:48:20 2017-client 4-filesize:3396
Thu Nov  2 14:48:20 2017-client 4-content:/*
 *  stream.c  -	(Topic 11, HX 22/5/1995)
 *	 	routines for stream read and write.
 */

#include  <sys/types.h>
#include  <netinet/in.h> /* struct sockaddr_in, htons(), htonl(), */
#include  "stream.h"

#include <unistd.h>
#include <stdio.h>




int writen(int sd, char *buf, int nbytes)
{
    short data_size = nbytes;     /* short must be two bytes long */
    int n, nw;

    if (nbytes > MAX_BLOCK_SIZE)
         return (-3);    /* too many bytes to send in one go */

    /* send the data size */
    data_size = htons(data_size);
    if (write(sd, (char *) &data_size, 1) != 1) return (-1);
    if (write(sd, (char *) (&data_size)+1, 1) != 1) return (-1);

    /* send nbytes */
    for (n=0; n<nbytes; n += nw) {
         if ((nw = write(sd, buf+n, nbytes-n)) <= 0)
             return (nw);    /* write error */
    }
    return (n);
}


int readn(int sd, char *buf, int bufsize)
{
    short data_size;    /* sizeof (short) must be 2 */
    int n, nr, len;

    /* check buffer size len */
    if (bufsize < MAX_BLOCK_SIZE)
         return (-3);     /* buffer too small */

    /* get the size of data sent to me */
    if (read(sd, (char *) &data_size, 1) != 1) return (-1);
    if (read(sd, (char *) (&data_size)+1, 1) != 1) return (-1);
    len = (int) ntohs(data_size);  /* convert to host byte order */

    /* read len number of bytes to buf */
    for (n=0; n < len; n += nr) {
        if ((nr = read(sd, buf+n, len-n)) <= 0)
            return (nr);       /* error in reading */
    }
    return (len);
}




int write_nbytes(int sd, char *buf, int nbytes)
{
	int nw = 0;
	int n = 0;
	for (n=0; n < nbytes; n += nw) {
		if ((nw = write(sd, buf+n, nbytes-n)) <= 0)
			return (nw);    /* write error */
		printf("sent %d bytes\n",nw);
	}
  return n;
}


int read_nbytes(int sd, char *buf, int nbytes)
{
	int nr = 1;
	int n = 0;
	for (n=0; (n < nbytes) && (nr > 0); n += nr) {
		printf("n:%d\n",n);
		printf("nr:%d\n",nr);
		if ((nr = read(sd, buf+n, nbytes-n)) < 0){
			printf("returning nr:%d\n",nr);
			return (nr);       /* error in reading */
		}
		printf("n:%d\n",n);
		printf("nr:%d\n",nr);
	}
	return (n);
}


int write_code(int sd, char code)
{

	/* send the code */
	if (write(sd, (char*)&code, 1) != 1) return (-1);

	//return success
	return 1;
}

int read_code(int sd, char* code)
{
	char data;

	// read 1 byte code from socket
	if(read(sd,(char *) &data,1) != 1)
		return -1; // read failed
	*code = data;
	// return success;
	return 1;
}


int write_twobytelength(int sd, int length)
{
	short data = length;
	data = htons(data);  //convert to network byte order

	if (write(sd,&data, 2) != 2) return (-1);

	return 1;
}

int read_twobytelength(int sd, int *length)
{
	short data = 0;

  if (read(sd, &data, 2) != 2) return (-1);
  short conv = ntohs(data); /* convert to host byte order */
  int t = (int)conv;
  *length = t;

	return 1;
}

int write_fourbytelength(int sd, int length)
{
	int data = htonl(length); //convert to network byte order

	if (write(sd,&data, 4) != 4) return (-1);

	return 1;
}

int read_fourbytelength(int sd, int *length)
{
	int data = 0;

  if (read(sd, &data, 4) != 4) return (-1);
  int conv = ntohl(data); /* convert to host byte order */
  *length = conv;

	return 1;
}



Thu Nov  2 14:48:20 2017-client 4-returned ackcode:0
Thu Nov  2 14:48:43 2017-client 4-disconnected
